- name: Create the control node for k8s
  include_tasks: create_vm.yml
  vars:
    vm_name: "{{ k8s_control_node }}"
    inventory_name: "master"
    inventory_group: "masters"
    vm_ip: "{{ k8s_allocated_ip }}"
    vm_ssh_port: "{{ k8s_control_node_ssh_port }}"
    vm_service_offering: "{{ vm_control_service_offering }}"

- name: Create worker nodes for k8s
  include_tasks: create_vm.yml
  loop: "{{ range(1, worker_count + 1) | list }}"
  loop_control:
    label: "{{ k8s_node }}-{{ item }}"
  vars:
    vm_name: "{{ k8s_node }}-{{ item }}"
    inventory_name: "worker{{ item }}"
    inventory_group: "workers"
    vm_ip: "{{ k8s_allocated_ip }}"
    vm_ssh_port: "{{ (k8s_control_node_ssh_port | int) + (item | int) }}"
    vm_service_offering: "{{ vm_worker_service_offering }}"

- name: Share vm names with other tasks
  set_fact:
    k8s_control_node: "{{ k8s_control_node }}"
    k8s_node: "{{ k8s_node }}" # worker nodes will be named k8s-worker-node-1, k8s-worker-node-2, etc.
